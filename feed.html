<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed - Nexus</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="story-filters.css">
</head>
<body class="feed-page">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loader"></div>
        <p>Carregando feed...</p>
    </div>

    <!-- Dashboard Layout -->
    <div class="dashboard-container">
        
        <!-- Sidebar Esquerda -->
        <aside class="sidebar glass">
            <div class="sidebar-header">
                <span class="sidebar-logo">Nexus</span>
            </div>
            <button id="newPostBtn" class="sidebar-new-post-btn">
                <span class="sidebar-new-post-icon">+</span>
                <span class="sidebar-new-post-text">Novo Post</span>
            </button>
            <nav class="sidebar-nav">
                <a href="index.html" class="sidebar-link">
                    <svg class="sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span class="sidebar-text">In√≠cio</span>
                </a>
                <a href="#" class="sidebar-link active">
                    <svg class="sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <span class="sidebar-text">Explorar</span>
                </a>
                <button id="notificationsBtn" class="sidebar-link">
                    <svg class="sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    <span class="sidebar-text">Notifica√ß√µes</span>
                    <span id="notificationsBadge" class="notifications-badge hidden">0</span>
                </button>
                <a href="#" class="sidebar-link">
                    <svg class="sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span class="sidebar-text">Perfil</span>
                </a>
            </nav>
            
            <!-- User Profile Card -->
            <div class="sidebar-profile-card glass">
                <div class="profile-card-content">
                    <img id="sidebarProfileAvatar" src="" alt="Avatar" class="profile-card-avatar">
                    <div class="profile-card-info">
                        <span id="sidebarProfileName" class="profile-card-name">Carregando...</span>
                        <span class="profile-card-label">Usu√°rio Logado</span>
                    </div>
                </div>
                <button id="logoutBtn" class="profile-card-logout-btn">
                    <svg class="logout-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span class="logout-text">Sair</span>
                </button>
            </div>
        </aside>

        <!-- Coluna Central (Feed) -->
        <main class="main-content">
            <!-- Barra de Stories -->
            <div id="stories-container" class="stories-container glass">
                <!-- Story do Usu√°rio -->
                <div class="story-item user-story">
                    <div class="story-circle" style="display: none;">
                        <img src="https://picsum.photos/seed/currentuser/100/100" alt="Seu Story" class="story-avatar">
                        <div class="story-add-btn" onclick="event.stopPropagation(); openFilePicker()">+</div>
                    </div>
                    <span class="story-username">Seu Story</span>
                </div>
            </div>
            
            <!-- Feed Container -->
            <div id="postsFeed" class="posts-feed">
                <!-- Posts ser√£o carregados aqui -->
            </div>

            <!-- Loading State -->
            <div id="feedLoading" class="feed-loading hidden">
                <div class="loader"></div>
                <p>Carregando mais posts...</p>
            </div>

            <!-- Empty State -->
            <div id="emptyFeed" class="empty-feed hidden">
                <div class="empty-icon">üìù</div>
                <h3 class="empty-title">Nenhum post ainda</h3>
                <p class="empty-description">Seja o primeiro a compartilhar algo!</p>
            </div>
        </main>

        <!-- Coluna Direita (Sugest√µes) -->
        <aside class="suggestions-sidebar glass">
            <div class="suggestions-header">
                <h3 class="suggestions-title">Sugest√µes de Contas</h3>
            </div>
            <div class="suggestions-list">
                <!-- Cards Dummy -->
                <div class="suggestion-card">
                    <img src="https://picsum.photos/seed/user1/50/50" alt="Avatar" class="suggestion-avatar">
                    <div class="suggestion-info">
                        <span class="suggestion-name">Ana Silva</span>
                        <span class="suggestion-username">@ana_silva</span>
                    </div>
                    <button class="suggestion-follow-btn">Seguir</button>
                </div>
                <div class="suggestion-card">
                    <img src="https://picsum.photos/seed/user2/50/50" alt="Avatar" class="suggestion-avatar">
                    <div class="suggestion-info">
                        <span class="suggestion-name">Carlos Santos</span>
                        <span class="suggestion-username">@carlos_santos</span>
                    </div>
                    <button class="suggestion-follow-btn">Seguir</button>
                </div>
                <div class="suggestion-card">
                    <img src="https://picsum.photos/seed/user3/50/50" alt="Avatar" class="suggestion-avatar">
                    <div class="suggestion-info">
                        <span class="suggestion-name">Mariana Costa</span>
                        <span class="suggestion-username">@mariana_costa</span>
                    </div>
                    <button class="suggestion-follow-btn">Seguir</button>
                </div>
                <div class="suggestion-card">
                    <img src="https://picsum.photos/seed/user4/50/50" alt="Avatar" class="suggestion-avatar">
                    <div class="suggestion-info">
                        <span class="suggestion-name">Pedro Lima</span>
                        <span class="suggestion-username">@pedro_lima</span>
                    </div>
                    <button class="suggestion-follow-btn">Seguir</button>
                </div>
                <div class="suggestion-card">
                    <img src="https://picsum.photos/seed/user5/50/50" alt="Avatar" class="suggestion-avatar">
                    <div class="suggestion-info">
                        <span class="suggestion-name">Julia Fernandes</span>
                        <span class="suggestion-username">@julia_fernandes</span>
                    </div>
                    <button class="suggestion-follow-btn">Seguir</button>
                </div>
            </div>
        </aside>
    </div>

    <!-- Comments Modal -->
    <div id="commentsModal" class="modal hidden">
        <div class="modal-content glass comments-modal">
            <div class="modal-header">
                <h3 class="modal-title">Coment√°rios</h3>
                <button id="closeCommentsBtn" class="modal-close">&times;</button>
            </div>
            <div class="comments-content">
                <div class="comments-media">
                    <div id="commentsPostMedia" class="comments-post-media">
                        <!-- M√≠dia do post ser√° carregada aqui -->
                    </div>
                </div>
                <div class="comments-section">
                    <div class="comments-scroll-container">
                        <div class="comments-list" id="commentsList">
                            <!-- Coment√°rios ser√£o carregados aqui -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="comment-input-section">
                <form id="commentForm" class="comment-form">
                    <textarea id="commentText" class="comment-textarea" placeholder="Digite seu coment√°rio..." rows="3"></textarea>
                    <button type="submit" class="comment-submit-btn">
                        Enviar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal hidden">
        <div class="modal-content glass notifications-modal">
            <div class="modal-header">
                <h3 class="modal-title">Notifica√ß√µes</h3>
                <button id="closeNotificationsBtn" class="modal-close">&times;</button>
            </div>
            <div class="notifications-content">
                <div id="notificationsList" class="notifications-list">
                    <!-- Notifica√ß√µes ser√£o carregadas aqui -->
                </div>
                <div id="emptyNotifications" class="empty-notifications hidden">
                    <div class="empty-icon">üîî</div>
                    <h3 class="empty-title">Nenhuma notifica√ß√£o</h3>
                    <p class="empty-description">Voc√™ n√£o tem novas notifica√ß√µes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="modal hidden">
        <div class="modal-content glass report-modal">
            <div class="modal-header">
                <h3 class="modal-title">Denunciar Conte√∫do</h3>
                <button id="closeReportBtn" class="modal-close">&times;</button>
            </div>
            <form id="reportForm">
                <div class="form-group">
                    <label for="reportReason" class="form-label">Motivo da den√∫ncia</label>
                    <select id="reportReason" class="form-input" required>
                        <option value="">Selecione um motivo</option>
                        <option value="spam">Spam</option>
                        <option value="inappropriate">Conte√∫do inapropriado</option>
                        <option value="harassment">Ass√©dio ou bullying</option>
                        <option value="fake_account">Conta falsa</option>
                        <option value="other">Outro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reportDescription" class="form-label">Descri√ß√£o (opcional)</label>
                    <textarea id="reportDescription" class="form-input" placeholder="Descreva o motivo da den√∫ncia..." rows="4"></textarea>
                </div>
                <button type="submit" class="auth-btn">Enviar Den√∫ncia</button>
                <div id="reportError" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Profile Setup Modal -->
    <div id="profileSetupModal" class="modal hidden">
        <div class="modal-content glass profile-setup">
            <div class="modal-header">
                <h3 class="modal-title">Configurar Perfil</h3>
                <button id="closeProfileSetupBtn" class="modal-close">&times;</button>
            </div>
            <div class="profile-setup-content">
                <div class="profile-preview">
                    <img id="profilePreview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Crect width='120' height='120' fill='%2339FF14'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='white' font-family='Arial' font-size='60'%3E?%3C/text%3E%3C/svg%3E" alt="Preview" class="profile-preview-img">
                </div>
                <div class="profile-actions">
                    <button id="chooseGalleryBtn" class="profile-btn primary">
                        <span>üì∑</span>
                        Escolher da Galeria
                    </button>
                    <button id="takePhotoBtn" class="profile-btn secondary">
                        <span>üì∏</span>
                        Tirar Foto
                    </button>
                </div>
                <div id="cameraSection" class="camera-section hidden">
                    <video id="cameraPreview" class="camera-preview" autoplay></video>
                    <button id="captureBtn" class="capture-btn">üì∏ Capturar</button>
                </div>
                <input type="file" id="profileFileInput" accept="image/*" class="hidden">
                <div class="profile-skip">
                    <button id="skipProfileBtn" class="skip-btn">Agora n√£o</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Feed Container -->
    <div class="feed-container">
        <!-- New Post Modal -->
        <div id="newPostModal" class="modal hidden">
            <div class="modal-content glass">
                <div class="modal-header">
                    <h3 class="modal-title">Criar Novo Post</h3>
                    <button id="closeModalBtn" class="modal-close">&times;</button>
                </div>
                <form id="newPostForm">
                    <div class="form-group">
                        <textarea id="postCaption" class="form-input" placeholder="Escreva algo incr√≠vel... (opcional)" rows="3"></textarea>
                    </div>
                    <button type="button" id="uploadBtn" class="upload-btn">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="currentColor" style="width: 20px; height: 20px; margin-right: 8px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Enviar M√≠dia
                    </button>
                    <div id="previewContainer" class="preview-container hidden">
                        <img id="mediaPreview" src="" alt="Preview">
                        <button type="button" id="removeMediaBtn" class="remove-media-btn">&times;</button>
                    </div>
                    <input type="hidden" id="mediaUrl" name="mediaUrl">
                    <input type="hidden" id="mediaType" name="mediaType">
                    <button type="submit" class="auth-btn">Publicar</button>
                </form>
            </div>
        </div>

        <!-- Posts Feed -->
        <div id="postsFeed" class="posts-feed">
            <!-- Posts ser√£o carregados dinamicamente -->
        </div>

        <!-- Loading Indicator -->
        <div id="feedLoading" class="feed-loading hidden">
            <div class="loader"></div>
            <p>Carregando posts...</p>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state hidden">
            <div class="empty-icon">üì∏</div>
            <h3 class="empty-title">Nenhum post ainda</h3>
            <p class="empty-description">Seja o primeiro a compartilhar um momento!</p>
        </div>
    </div>

    <!-- Modal de Visualiza√ß√£o de Story -->
    <div id="story-modal" class="story-modal-overlay" style="display: none;">
        <div class="story-modal-content">
            <!-- Contador de Stories -->
            <div class="story-counter-container">
                <div class="story-counter-dots" id="storyCounterDots">
                    <!-- Dots ser√£o gerados dinamicamente -->
                </div>
            </div>
            
            <!-- Bot√µes de Navega√ß√£o -->
            <button class="story-nav-btn story-nav-prev" onclick="navigatePrevStory()">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            </button>
            <button class="story-nav-btn story-nav-next" onclick="navigateNextStory()">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                </svg>
            </button>
            
            <!-- Barra de Progresso -->
            <div class="story-progress-container">
                <div class="story-progress-bar">
                    <div class="story-progress-fill"></div>
                </div>
            </div>

            <!-- Bot√£o Fechar -->
            <button class="story-close-btn" onclick="closeStoryModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            
            <!-- Bot√£o Excluir Story -->
            <button class="story-delete-modal-btn" onclick="deleteCurrentViewingStory()">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                </svg>
            </button>

            <!-- Imagem do Story -->
            <div class="story-media-container">
                <img id="story-media" src="" alt="Story" class="story-media">
            </div>

            <!-- Overlay para clique -->
            <div class="story-click-overlay" onclick="closeStoryModal()"></div>
        </div>
    </div>

    <!-- Modal de Filtros de Story -->
    <div id="story-filters-modal" class="story-filters-modal">
        <div class="story-filters-content">
            <div class="story-filters-header">
                <h3>Personalizar Story</h3>
                <button class="story-filters-close-btn" onclick="closeStoryFiltersModal()">√ó</button>
            </div>
            
            <div class="story-filters-body">
                <!-- Preview da imagem/v√≠deo -->
                <div class="story-preview-section">
                    <div class="story-preview-container">
                        <img id="story-preview" src="" alt="Preview" class="story-preview-img">
                        <video id="story-video-preview" controls class="story-preview-video" style="display: none;"></video>
                    </div>
                </div>
                
                <!-- Filtros dispon√≠veis -->
                <div class="story-filters-section">
                    <h4>Filtros</h4>
                    <div class="filters-grid">
                        <div class="filter-item active" data-filter="none" onclick="applyStoryFilter('none')">
                            <div class="filter-preview" style="filter: none;"></div>
                            <span>Normal</span>
                        </div>
                        <div class="filter-item" data-filter="grayscale" onclick="applyStoryFilter('grayscale')">
                            <div class="filter-preview" style="filter: grayscale(100%);"></div>
                            <span>P&B</span>
                        </div>
                        <div class="filter-item" data-filter="sepia" onclick="applyStoryFilter('sepia')">
                            <div class="filter-preview" style="filter: sepia(100%);"></div>
                            <span>S√©pia</span>
                        </div>
                        <div class="filter-item" data-filter="blur" onclick="applyStoryFilter('blur')">
                            <div class="filter-preview" style="filter: blur(2px);"></div>
                            <span>Desfoque</span>
                        </div>
                        <div class="filter-item" data-filter="brightness" onclick="applyStoryFilter('brightness')">
                            <div class="filter-preview" style="filter: brightness(1.3);"></div>
                            <span>Brilho</span>
                        </div>
                        <div class="filter-item" data-filter="contrast" onclick="applyStoryFilter('contrast')">
                            <div class="filter-preview" style="filter: contrast(1.5);"></div>
                            <span>Contraste</span>
                        </div>
                        <div class="filter-item" data-filter="hue-rotate" onclick="applyStoryFilter('hue-rotate')">
                            <div class="filter-preview" style="filter: hue-rotate(90deg);"></div>
                            <span>Cores</span>
                        </div>
                        <div class="filter-item" data-filter="saturate" onclick="applyStoryFilter('saturate')">
                            <div class="filter-preview" style="filter: saturate(2);"></div>
                            <span>Saturado</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="story-filters-footer">
                <button class="story-filters-cancel-btn" onclick="closeStoryFiltersModal()">Cancelar</button>
                <button class="story-filters-post-btn" onclick="postStoryWithFilter()">Postar Story</button>
            </div>
        </div>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="feed.js"></script>
</body>
</html>
